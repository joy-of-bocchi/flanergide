# RealitySkin - Nico-Nico Style AI Scrolling Messages

An Android app that displays AI-generated scrolling messages across your screen, powered by an on-device Phi-2 LLM.

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![API](https://img.shields.io/badge/API-29%2B-brightgreen.svg)
![Kotlin](https://img.shields.io/badge/Kotlin-1.9-purple.svg)

---

## ğŸ¯ What It Does

RealitySkin displays **Nico-nico style scrolling text** across your screen, similar to the comment overlay system on Niconico (Japanese video platform). The twist: messages are **generated by an on-device AI** (Phi-2 LLM) responding to random prompts.

### Features

- ğŸ¤– **On-Device AI**: Phi-2 quantized to Q4_K_M (1.6 GB)
- ğŸ“± **System Overlays**: Messages scroll over any app
- ğŸ¨ **Nico-Nico Style**: Random directions, speeds, positions, and sizes
- âš¡ **Reactive Architecture**: EventBus + StateStore pattern
- ğŸ”„ **Auto-Generated**: New messages every 10-30 seconds

---

## ğŸ—ï¸ Architecture

### High-Level Design

```
AIOrchestrator (generates text)
    â†“
EventBus (decoupled communication)
    â†“
StateStore (single source of truth)
    â†“
OverlayEngine (renders UI)
    â†“
WindowManager (system overlay)
```

### Modules

1. **Core** (`core/`)
   - `EventBus`: SharedFlow-based event hub
   - `StateStore`: StateFlow-based state manager
   - `Events`: Sealed class event definitions
   - `AppState`: Immutable global state

2. **AI** (`ai/`)
   - `GGUFModel`: Wraps llama.cpp Android library
   - `AIOrchestrator`: Message generation logic
   - `MessageGenerator`: Random prompt generator

3. **Overlay** (`overlay/`)
   - `OverlayEngine`: WindowManager integration
   - `ScrollingMessageOverlay`: Compose UI for messages

4. **Permissions** (`permissions/`)
   - `PermissionManager`: Tracks SYSTEM_ALERT_WINDOW permission

5. **Service** (`RealityService`)
   - Foreground service keeping app alive
   - Module initialization and lifecycle management

---

## ğŸ“¦ Installation

### Prerequisites

- Android Studio Hedgehog or later
- Android device/emulator (API 29+)
- ~2 GB free storage (for model)

### Build Steps

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd RealitySkin
   ```

2. **Verify model file exists**
   ```bash
   ls -lh app/src/main/assets/models/phi-2-q4_k_m.gguf
   # Should show ~1.6 GB
   ```

3. **Sync Gradle**
   ```bash
   # In Android Studio:
   File â†’ Sync Project with Gradle Files
   ```

4. **Build and Run**
   ```bash
   ./gradlew installDebug
   # Or use Android Studio: Run â†’ Run 'app'
   ```

5. **Grant Permission**
   - Open app
   - Tap "Grant Overlay Permission"
   - Enable in Settings
   - Return to app

6. **Wait for first message** (~10-30 seconds)

---

## ğŸ® Usage

### First Launch

1. App opens â†’ starts RealityService
2. Service loads Phi-2 model (takes 5-10 seconds)
3. After 10-30 seconds, first message appears
4. New messages appear every 10-30 seconds

### Message Behavior

- **Direction**: Random (left-to-right OR right-to-left)
- **Speed**: 5-15 seconds animation duration
- **Position**: Random Y position (0-800px from top)
- **Font Size**: 16-28sp (randomized)
- **Concurrency**: Up to 5 messages on screen simultaneously

### Example Prompts

The AI responds to prompts like:
- "Say something funny about cats in one sentence"
- "Give a random life tip"
- "Tell me a weird fact"
- "Say something inspiring"
- "What's the meaning of life? (wrong answers only)"

---

## ğŸ› ï¸ Development

### Project Structure

```
app/src/main/java/com/realityskin/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ EventBus.kt
â”‚   â”œâ”€â”€ StateStore.kt
â”‚   â”œâ”€â”€ Events.kt
â”‚   â””â”€â”€ AppState.kt
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ MLModel.kt
â”‚   â”œâ”€â”€ GGUFModel.kt
â”‚   â”œâ”€â”€ AIOrchestrator.kt
â”‚   â””â”€â”€ MessageGenerator.kt
â”œâ”€â”€ overlay/
â”‚   â”œâ”€â”€ OverlayEngine.kt
â”‚   â””â”€â”€ composables/
â”‚       â””â”€â”€ ScrollingMessageOverlay.kt
â”œâ”€â”€ permissions/
â”‚   â””â”€â”€ PermissionManager.kt
â”œâ”€â”€ RealityService.kt
â””â”€â”€ MainActivity.kt
```

### Key Dependencies

- **Jetpack Compose**: UI framework
- **Kotlin Coroutines**: Async operations
- **llama.cpp Android**: On-device LLM inference
- **Flow/StateFlow**: Reactive state management

### Model Information

- **Model**: microsoft/phi-2
- **Format**: GGUF (Q4_K_M quantization)
- **Size**: 1.6 GB (68% smaller than FP16)
- **Parameters**: 2.7 billion
- **Inference Time**: ~1-3 seconds per message

---

## ğŸ”§ Configuration

### Changing Message Frequency

Edit `AIOrchestrator.kt`:
```kotlin
// Default: 10-30 seconds
fun getRandomInterval(): Long {
    return Random.nextLong(10_000, 30_000)
}

// Make it faster: 5-10 seconds
fun getRandomInterval(): Long {
    return Random.nextLong(5_000, 10_000)
}
```

### Adding Custom Prompts

Edit `MessageGenerator.kt`:
```kotlin
private val prompts = listOf(
    "Your custom prompt here",
    "Another custom prompt",
    // ... add more
)
```

### Adjusting Overlay Limits

Edit `OverlayEngine.kt`:
```kotlin
// Default: 5 concurrent messages
private const val MAX_CONCURRENT_MESSAGES = 5

// Show more: 10 concurrent messages
private const val MAX_CONCURRENT_MESSAGES = 10
```

---

## ğŸ“Š Performance

### Expected Metrics

- **Model Load Time**: 5-10 seconds (one-time on startup)
- **Inference Time**: 1-3 seconds per message (100 tokens)
- **Memory Usage**: ~2.5 GB (model + Android overhead)
- **Battery Impact**: Moderate (foreground service + periodic inference)

### Optimization Tips

1. **Reduce frequency**: Increase interval between messages
2. **Lower concurrency**: Reduce MAX_CONCURRENT_MESSAGES
3. **Shorter prompts**: Generate fewer tokens per inference
4. **Use mock mode**: Set `mlModel = null` in AIOrchestrator

---

## ğŸ› Troubleshooting

### No messages appearing

**Check**:
1. Permission granted? (Settings â†’ Apps â†’ RealitySkin â†’ Display over other apps)
2. Model loaded? (Check logcat for "Model loaded successfully")
3. Service running? (Notification should be visible)

**Logcat**:
```bash
adb logcat | grep -E "(AIOrchestrator|OverlayEngine)"
```

### App crashes on launch

**Common causes**:
- Model file missing from assets
- llama.cpp module not linked
- Insufficient memory

**Fix**:
```bash
# Verify model exists
ls -lh app/src/main/assets/models/phi-2-q4_k_m.gguf

# Re-sync Gradle
File â†’ Sync Project with Gradle Files
```

### Model loading too slow

**Fallback**: AIOrchestrator automatically falls back to mock responses if model fails to load.

**Check logcat**:
```bash
adb logcat | grep GGUFModel
```

---

## ğŸ“ Documentation

- **Architecture**: See `CLAUDE.md` (top-level overview)
- **Build Verification**: See `BUILD_VERIFICATION.md`
- **Module Details**: See `CLAUDE.md` in each module directory
  - `app/src/main/java/com/realityskin/core/CLAUDE.md`
  - `app/src/main/java/com/realityskin/ai/CLAUDE.md`
  - `app/src/main/java/com/realityskin/overlay/CLAUDE.md`
  - etc.

---

## ğŸš€ Future Enhancements

- [ ] User-configurable prompts
- [ ] Message history viewer
- [x] Random fonts per message (FontProvider)
- [ ] Avatar overlay with mood reactions
- [ ] Notification listener integration
- [ ] Mini-games for app gating
- [ ] Multiple AI personalities
- [ ] Voice output (TTS)

---

## ğŸ“„ License

This project is licensed under the MIT License.

---

## ğŸ™ Acknowledgments

- **llama.cpp**: For the excellent Android bindings
- **Microsoft**: For the Phi-2 model
- **Niconico**: For the inspiration

---

## ğŸ’¬ Contact

For issues and questions, please use the GitHub issue tracker.

---

**Built with â¤ï¸ using Kotlin, Jetpack Compose, and on-device AI**
